"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[577],{5769:(e,t,i)=>{var o=i(6824).default,r=o(i(6579)),n=o(i(1887)),s=i(8904),l=s.INTERNAL_ACTOR_IDENTIFIER_DO_NOT_USE,u=s.assertInternalActorIdentifier,c=(i(6973),i(2761)),a=i(4637),h=i(2154),d=i(8179),_=i(2306),f=i(3697),v=i(4964),p=i(761),g=i(9330),S=i(8677),R=i(8677),I=R.ROOT_ID,C=R.ROOT_TYPE,D=i(3922).RecordResolverCache,m=i(9990),E=function(){function e(e,t){var i,o,r,s,l,u=this;(0,n.default)(this,"_gcStep",(function(){u._gcRun&&(u._gcRun.next().done?u._gcRun=null:u._gcScheduler(u._gcStep))})),this._currentWriteEpoch=0,this._gcHoldCounter=0,this._gcReleaseBufferSize=null!==(i=null==t?void 0:t.gcReleaseBufferSize)&&void 0!==i?i:10,this._gcRun=null,this._gcScheduler=null!==(o=null==t?void 0:t.gcScheduler)&&void 0!==o?o:a,this._getDataID=null!==(r=null==t?void 0:t.getDataID)&&void 0!==r?r:d,this._globalInvalidationEpoch=null,this._invalidationSubscriptions=new Set,this._invalidatedRecordIDs=new Set,this.__log=null!==(s=null==t?void 0:t.log)&&void 0!==s?s:null,this._queryCacheExpirationTime=null==t?void 0:t.queryCacheExpirationTime,this._operationLoader=null!==(l=null==t?void 0:t.operationLoader)&&void 0!==l?l:null,this._optimisticSource=null,this._recordSource=e,this._releaseBuffer=[],this._roots=new Map,this._shouldScheduleGC=!1,this._resolverCache=new D((function(){return u._getMutableRecordSource()})),this._storeSubscriptions=new g(null==t?void 0:t.log,this._resolverCache),this._updatedRecordIDs=new Set,this._shouldProcessClientComponents=null==t?void 0:t.shouldProcessClientComponents,function(e){if(!e.has(I)){var t=_.create(I,C);e.set(I,t)}}(this._recordSource)}var t=e.prototype;return t.getSource=function(){var e;return null!==(e=this._optimisticSource)&&void 0!==e?e:this._recordSource},t._getMutableRecordSource=function(){var e;return null!==(e=this._optimisticSource)&&void 0!==e?e:this._recordSource},t.check=function(e,t){var i,o,r,n,s=e.root,c=this._getMutableRecordSource(),a=this._globalInvalidationEpoch,d=this._roots.get(e.request.identifier),_=null!=d?d.epoch:null;if(null!=a&&(null==_||_<=a))return{status:"stale"};var f=null!==(i=null==t?void 0:t.handlers)&&void 0!==i?i:[],v=null!==(o=null==t?void 0:t.getSourceForActor)&&void 0!==o?o:function(e){return u(e),c},p=null!==(r=null==t?void 0:t.getTargetForActor)&&void 0!==r?r:function(e){return u(e),c};return function(e,t,i,o){var r=e.mostRecentlyInvalidatedAt,n=e.status;return"number"==typeof r&&(null==t||r>t)?{status:"stale"}:"missing"===n?{status:"missing"}:null!=i&&null!=o&&i<=Date.now()-o?{status:"stale"}:{status:"available",fetchTime:null!=i?i:null}}(h.check(v,p,null!==(n=null==t?void 0:t.defaultActorIdentifier)&&void 0!==n?n:l,s,f,this._operationLoader,this._getDataID,this._shouldProcessClientComponents),_,null==d?void 0:d.fetchTime,this._queryCacheExpirationTime)},t.retain=function(e){var t=this,i=e.request.identifier,o=!1,r=this._roots.get(i);return null!=r?(0===r.refCount&&(this._releaseBuffer=this._releaseBuffer.filter((function(e){return e!==i}))),r.refCount+=1):this._roots.set(i,{operation:e,refCount:1,epoch:null,fetchTime:null}),{dispose:function(){if(!o){o=!0;var e=t._roots.get(i);if(null!=e&&(e.refCount--,0===e.refCount)){var r=t._queryCacheExpirationTime;if(null!=e.fetchTime&&null!=r&&e.fetchTime<=Date.now()-r)t._roots.delete(i),t.scheduleGC();else if(t._releaseBuffer.push(i),t._releaseBuffer.length>t._gcReleaseBufferSize){var n=t._releaseBuffer.shift();t._roots.delete(n),t.scheduleGC()}}}}}},t.lookup=function(e){var t=this.getSource();return v.read(t,e,this._resolverCache)},t.notify=function(e,t){var i=this,o=this.__log;null!=o&&o({name:"store.notify.start",sourceOperation:e}),this._currentWriteEpoch++,!0===t&&(this._globalInvalidationEpoch=this._currentWriteEpoch),c.ENABLE_RELAY_RESOLVERS&&this._resolverCache.invalidateDataIDs(this._updatedRecordIDs);var r=this.getSource(),n=[];if(this._storeSubscriptions.updateSubscriptions(r,this._updatedRecordIDs,n,e),this._invalidationSubscriptions.forEach((function(e){i._updateInvalidationSubscription(e,!0===t)})),null!=o&&o({name:"store.notify.complete",sourceOperation:e,updatedRecordIDs:this._updatedRecordIDs,invalidatedRecordIDs:this._invalidatedRecordIDs}),this._updatedRecordIDs.clear(),this._invalidatedRecordIDs.clear(),null!=e){var s=e.request.identifier,l=this._roots.get(s);if(null!=l)l.epoch=this._currentWriteEpoch,l.fetchTime=Date.now();else if("query"===e.request.node.params.operationKind&&this._gcReleaseBufferSize>0&&this._releaseBuffer.length<this._gcReleaseBufferSize){var u={operation:e,refCount:0,epoch:this._currentWriteEpoch,fetchTime:Date.now()};this._releaseBuffer.push(s),this._roots.set(s,u)}}return n},t.publish=function(e,t){var i=this._getMutableRecordSource();!function(e,t,i,o,r,n){o&&o.forEach((function(o){var r,s=e.get(o),l=t.get(o);null!==l&&(r=null!=s?_.clone(s):null!=l?_.clone(l):null)&&(_.setValue(r,S.INVALIDATED_AT_KEY,i),n.add(o),e.set(o,r))}));for(var s=t.getRecordIDs(),l=0;l<s.length;l++){var u=s[l],c=t.get(u),a=e.get(u);if(c&&a){var h=_.update(a,c);h!==a&&(r.add(u),e.set(u,h))}else null===c?(e.delete(u),null!==a&&r.add(u)):c&&(e.set(u,c),r.add(u))}}(i,e,this._currentWriteEpoch+1,t,this._updatedRecordIDs,this._invalidatedRecordIDs);var o=this.__log;null!=o&&o({name:"store.publish",source:e,optimistic:i===this._optimisticSource})},t.subscribe=function(e,t){return this._storeSubscriptions.subscribe(e,t)},t.holdGC=function(){var e=this;return this._gcRun&&(this._gcRun=null,this._shouldScheduleGC=!0),this._gcHoldCounter++,{dispose:function(){e._gcHoldCounter>0&&(e._gcHoldCounter--,0===e._gcHoldCounter&&e._shouldScheduleGC&&(e.scheduleGC(),e._shouldScheduleGC=!1))}}},t.toJSON=function(){return"RelayModernStore()"},t.getEpoch=function(){return this._currentWriteEpoch},t.__getUpdatedRecordIDs=function(){return this._updatedRecordIDs},t.lookupInvalidationState=function(e){var t=this,i=new Map;return e.forEach((function(e){var o,r=t.getSource().get(e);i.set(e,null!==(o=_.getInvalidationEpoch(r))&&void 0!==o?o:null)})),i.set("global",this._globalInvalidationEpoch),{dataIDs:e,invalidations:i}},t.checkInvalidationState=function(e){var t=this.lookupInvalidationState(e.dataIDs).invalidations,i=e.invalidations;if(t.get("global")!==i.get("global"))return!0;var o,n=(0,r.default)(e.dataIDs);try{for(n.s();!(o=n.n()).done;){var s=o.value;if(t.get(s)!==i.get(s))return!0}}catch(e){n.e(e)}finally{n.f()}return!1},t.subscribeToInvalidationState=function(e,t){var i=this,o={callback:t,invalidationState:e};return this._invalidationSubscriptions.add(o),{dispose:function(){i._invalidationSubscriptions.delete(o)}}},t._updateInvalidationSubscription=function(e,t){var i=this,o=e.callback,r=e.invalidationState.dataIDs;(t||r.some((function(e){return i._invalidatedRecordIDs.has(e)})))&&o()},t.snapshot=function(){null!=this._optimisticSource&&m(!1);var e=this.__log;null!=e&&e({name:"store.snapshot"}),this._storeSubscriptions.snapshotSubscriptions(this.getSource()),this._gcRun&&(this._gcRun=null,this._shouldScheduleGC=!0),this._optimisticSource=f.create(this.getSource())},t.restore=function(){null==this._optimisticSource&&m(!1);var e=this.__log;null!=e&&e({name:"store.restore"}),this._optimisticSource=null,this._shouldScheduleGC&&this.scheduleGC(),this._storeSubscriptions.restoreSubscriptions()},t.scheduleGC=function(){this._gcHoldCounter>0?this._shouldScheduleGC=!0:this._gcRun||(this._gcRun=this._collect(),this._gcScheduler(this._gcStep))},t.__gc=function(){if(null==this._optimisticSource)for(var e=this._collect();!e.next().done;);},t._collect=function*(){e:for(;;){var e,t=this._currentWriteEpoch,i=new Set,o=(0,r.default)(this._roots.values());try{for(o.s();!(e=o.n()).done;){var n=e.value.operation.root;if(p.mark(this._recordSource,n,i,this._operationLoader,this._shouldProcessClientComponents),yield,t!==this._currentWriteEpoch)continue e}}catch(e){o.e(e)}finally{o.f()}var s=this.__log;if(null!=s&&s({name:"store.gc",references:i}),0===i.size)this._recordSource.clear();else for(var l=this._recordSource.getRecordIDs(),u=0;u<l.length;u++){var c=l[u];i.has(c)||this._recordSource.remove(c)}return}},e}();e.exports=E}}]);
//# sourceMappingURL=RelayModernStore.js.js.map?380f5