"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[342],{9813:(e,t,i)=>{var s=i(1600).default,o=s(i(8636)),r=s(i(3408)),n=i(8122),a=i(1650),l=i(1677),u=i(196),c=i(1362),p=i(5178),d=i(4352),h=i(6190),_=h.generateClientID,f=h.generateUniqueClientID,m=i(378).getLocalVariables,v=i(5180),g=i(4711),y=g.createNormalizationSelector,P=g.createReaderSelector,I=i(7428),b=i(8475),D=b.ROOT_TYPE,A=b.TYPENAME_KEY,S=b.getStorageKey,k=i(7677);i(6590);var x=function(){function e(e){var t=this,i=e.actorIdentifier,s=e.getDataID,o=e.getPublishQueue,r=e.getStore,n=e.isClientPayload,l=e.operation,u=e.operationExecutions,c=e.operationLoader,p=e.operationTracker,d=e.optimisticConfig,h=e.scheduler,_=e.shouldProcessClientComponents,f=e.sink,m=e.source,v=e.treatMissingFieldsAsNull,g=e.updater,y=e.log,P=e.normalizeResponse;this._actorIdentifier=i,this._getDataID=s,this._treatMissingFieldsAsNull=v,this._incrementalPayloadsPending=!1,this._incrementalResults=new Map,this._log=y,this._executeId=a(),this._nextSubscriptionId=0,this._operation=l,this._operationExecutions=u,this._operationLoader=c,this._operationTracker=p,this._operationUpdateEpochs=new Map,this._optimisticUpdates=null,this._pendingModulePayloadsCount=0,this._getPublishQueue=o,this._scheduler=h,this._sink=f,this._source=new Map,this._state="started",this._getStore=r,this._subscriptions=new Map,this._updater=g,this._isClientPayload=!0===n,this._isSubscriptionOperation="subscription"===this._operation.request.node.params.operationKind,this._shouldProcessClientComponents=_,this._retainDisposables=new Map,this._seenActors=new Set,this._completeFns=[],this._normalizeResponse=P;var I=this._nextSubscriptionId++;m.subscribe({complete:function(){return t._complete(I)},error:function(e){return t._error(e)},next:function(e){try{t._next(I,e)}catch(e){f.error(e)}},start:function(e){var i;t._start(I,e),t._log({name:"execute.start",executeId:t._executeId,params:t._operation.request.node.params,variables:t._operation.request.variables,cacheConfig:null!==(i=t._operation.request.cacheConfig)&&void 0!==i?i:{}})}}),null!=d&&this._processOptimisticResponse(null!=d.response?{data:d.response}:null,d.updater,!1)}var t=e.prototype;return t.cancel=function(){var e=this;if("completed"!==this._state){this._state="completed",this._operationExecutions.delete(this._operation.request.identifier),0!==this._subscriptions.size&&(this._subscriptions.forEach((function(e){return e.unsubscribe()})),this._subscriptions.clear());var t=this._optimisticUpdates;null!==t&&(this._optimisticUpdates=null,t.forEach((function(t){return e._getPublishQueueAndSaveActor().revertUpdate(t)})),this._runPublishQueue()),this._incrementalResults.clear(),null!=this._asyncStoreUpdateDisposable&&(this._asyncStoreUpdateDisposable.dispose(),this._asyncStoreUpdateDisposable=null),this._completeFns=[],this._completeOperationTracker(),this._disposeRetainedData()}},t._updateActiveState=function(){var e;switch(this._state){case"started":case"loading_incremental":e="active";break;case"completed":e="inactive";break;case"loading_final":e=this._pendingModulePayloadsCount>0?"active":"inactive";break;default:this._state,k(!1)}this._operationExecutions.set(this._operation.request.identifier,e)},t._schedule=function(e){var t=this,i=this._scheduler;if(null!=i){var s=this._nextSubscriptionId++;n.create((function(t){var s=i.schedule((function(){try{e(),t.complete()}catch(e){t.error(e)}}));return function(){return i.cancel(s)}})).subscribe({complete:function(){return t._complete(s)},error:function(e){return t._error(e)},start:function(e){return t._start(s,e)}})}else e()},t._complete=function(e){this._subscriptions.delete(e),0===this._subscriptions.size&&(this.cancel(),this._sink.complete(),this._log({name:"execute.complete",executeId:this._executeId}))},t._error=function(e){this.cancel(),this._sink.error(e),this._log({name:"execute.error",executeId:this._executeId,error:e})},t._start=function(e,t){this._subscriptions.set(e,t),this._updateActiveState()},t._next=function(e,t){var i=this;this._schedule((function(){var e=d((function(){i._handleNext(t),i._maybeCompleteSubscriptionOperationTracking()}))[0];i._log({name:"execute.next",executeId:i._executeId,response:t,duration:e})}))},t._handleErrorResponse=function(e){var t=this,i=[];return e.forEach((function(e){if(null!==e.data||null==e.extensions||e.hasOwnProperty("errors")){if(null==e.data){var s=e.hasOwnProperty("errors")&&null!=e.errors?e.errors:null,o=s?s.map((function(e){return e.message})).join("\n"):"(No errors)",r=u.create("RelayNetwork","No data returned for operation `"+t._operation.request.node.params.name+"`, got error(s):\n"+o+"\n\nSee the error `source` property for more information.");throw r.source={errors:s,operation:t._operation.request.node,variables:t._operation.request.variables},r.stack,r}var n=e;i.push(n)}})),i},t._handleOptimisticResponses=function(e){var t;if(e.length>1)return e.some((function(e){var t;return!0===(null===(t=e.extensions)||void 0===t?void 0:t.isOptimistic)}))&&k(!1),!1;var i=e[0],s=!0===(null===(t=i.extensions)||void 0===t?void 0:t.isOptimistic);return s&&"started"!==this._state&&k(!1),!!s&&(this._processOptimisticResponse(i,null,this._treatMissingFieldsAsNull),this._sink.next(i),!0)},t._handleNext=function(e){if("completed"!==this._state){this._seenActors.clear();var t=Array.isArray(e)?e:[e],i=this._handleErrorResponse(t);if(0===i.length)return t.some((function(e){var t;return!0===(null===(t=e.extensions)||void 0===t?void 0:t.is_final)}))&&(this._state="loading_final",this._updateActiveState(),this._incrementalPayloadsPending=!1),void this._sink.next(e);if(!this._handleOptimisticResponses(i)){var s=function(e){var t=[],i=[];return e.forEach((function(e){if(null!=e.path||null!=e.label){var s=e.label,o=e.path;null!=s&&null!=o||k(!1),i.push({label:s,path:o,response:e})}else t.push(e)})),[t,i]}(i),o=s[0],r=s[1],n=o.length>0;if(n){if(this._isSubscriptionOperation){var a=f();this._operation={request:this._operation.request,fragment:P(this._operation.fragment.node,a,this._operation.fragment.variables,this._operation.fragment.owner),root:y(this._operation.root.node,a,this._operation.root.variables)}}var l=this._processResponses(o);this._processPayloadFollowups(l)}if(r.length>0){var u=this._processIncrementalResponses(r);this._processPayloadFollowups(u)}this._isSubscriptionOperation&&(null==i[0].extensions?i[0].extensions={__relay_subscription_root_id:this._operation.fragment.dataID}:i[0].extensions.__relay_subscription_root_id=this._operation.fragment.dataID);var c=this._runPublishQueue(n?this._operation:void 0);n&&this._incrementalPayloadsPending&&this._retainData(),this._updateOperationTracker(c),this._sink.next(e)}}},t._processOptimisticResponse=function(e,t,i){var s=this;if(null!==this._optimisticUpdates&&k(!1),null!=e||null!=t){var o=[];if(e){var r=this._normalizeResponse(e,this._operation.root,D,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:[],shouldProcessClientComponents:this._shouldProcessClientComponents,treatMissingFieldsAsNull:i});O(r),o.push({operation:this._operation,payload:r,updater:t}),this._processOptimisticFollowups(r,o)}else t&&o.push({operation:this._operation,payload:{errors:null,fieldPayloads:null,incrementalPlaceholders:null,followupPayloads:null,source:I.create(),isFinal:!1},updater:t});this._optimisticUpdates=o,o.forEach((function(e){return s._getPublishQueueAndSaveActor().applyUpdate(e)}));var n=this._runPublishQueue();c.ENABLE_OPERATION_TRACKER_OPTIMISTIC_UPDATES&&this._updateOperationTracker(n)}},t._processOptimisticFollowups=function(e,t){if(e.followupPayloads&&e.followupPayloads.length){var i,s=e.followupPayloads,n=(0,o.default)(s);try{for(n.s();!(i=n.n()).done;){var a=i.value;switch(a.kind){case"ModuleImportPayload":var l=this._expectOperationLoader().get(a.operationReference);if(null==l)this._processAsyncOptimisticModuleImport(a);else{var u=this._processOptimisticModuleImport(l,a);t.push.apply(t,(0,r.default)(u))}break;case"ActorPayload":break;default:k(!1)}}}catch(e){n.e(e)}finally{n.f()}}},t._normalizeFollowupPayload=function(e,t){var i;i="SplitOperation"===t.kind&&"ModuleImportPayload"===e.kind?m(e.variables,t.argumentDefinitions,e.args):e.variables;var s=y(t,e.dataID,i);return this._normalizeResponse({data:e.data},s,e.typeName,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:e.path,treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents})},t._processOptimisticModuleImport=function(e,t){var i=l(e),s=[],o=this._normalizeFollowupPayload(t,i);return O(o),s.push({operation:this._operation,payload:o,updater:null}),this._processOptimisticFollowups(o,s),s},t._processAsyncOptimisticModuleImport=function(e){var t=this;this._expectOperationLoader().load(e.operationReference).then((function(i){if(null!=i&&"started"===t._state){var s,o=t._processOptimisticModuleImport(i,e);o.forEach((function(e){return t._getPublishQueueAndSaveActor().applyUpdate(e)})),null==t._optimisticUpdates||((s=t._optimisticUpdates).push.apply(s,(0,r.default)(o)),t._runPublishQueue())}}))},t._processResponses=function(e){var t=this;return null!==this._optimisticUpdates&&(this._optimisticUpdates.forEach((function(e){t._getPublishQueueAndSaveActor().revertUpdate(e)})),this._optimisticUpdates=null),this._incrementalPayloadsPending=!1,this._incrementalResults.clear(),this._source.clear(),e.map((function(e){var i=t._normalizeResponse(e,t._operation.root,D,{actorIdentifier:t._actorIdentifier,getDataID:t._getDataID,path:[],treatMissingFieldsAsNull:t._treatMissingFieldsAsNull,shouldProcessClientComponents:t._shouldProcessClientComponents});return t._getPublishQueueAndSaveActor().commitPayload(t._operation,i,t._updater),i}))},t._processPayloadFollowups=function(e){var t=this;"completed"!==this._state&&e.forEach((function(e){var i=e.incrementalPlaceholders,s=e.followupPayloads,o=e.isFinal;if(t._state=o?"loading_final":"loading_incremental",t._updateActiveState(),o&&(t._incrementalPayloadsPending=!1),s&&0!==s.length&&s.forEach((function(e){var i,s=t._actorIdentifier;t._actorIdentifier=null!==(i=e.actorIdentifier)&&void 0!==i?i:t._actorIdentifier,t._processFollowupPayload(e),t._actorIdentifier=s})),i&&0!==i.length&&(t._incrementalPayloadsPending="loading_final"!==t._state,i.forEach((function(i){var s,o=t._actorIdentifier;t._actorIdentifier=null!==(s=i.actorIdentifier)&&void 0!==s?s:t._actorIdentifier,t._processIncrementalPlaceholder(e,i),t._actorIdentifier=o})),t._isClientPayload||"loading_final"===t._state)){var r=[];i.forEach((function(e){"defer"===e.kind&&r.push(t._processDeferResponse(e.label,e.path,e,{data:e.data}))})),r.length>0&&t._processPayloadFollowups(r)}}))},t._maybeCompleteSubscriptionOperationTracking=function(){this._isSubscriptionOperation&&0===this._pendingModulePayloadsCount&&!1===this._incrementalPayloadsPending&&this._completeOperationTracker()},t._processFollowupPayload=function(e){var t=this;switch(e.kind){case"ModuleImportPayload":var i=this._expectOperationLoader(),s=i.get(e.operationReference);if(null!=s)this._processFollowupPayloadWithNormalizationNode(e,l(s));else{var o=this._nextSubscriptionId++;this._pendingModulePayloadsCount++;var r=function(){t._pendingModulePayloadsCount--,t._maybeCompleteSubscriptionOperationTracking()},a=n.from(new Promise((function(t,s){i.load(e.operationReference).then(t,s)})));n.create((function(i){var s,o=a.subscribe({next:function(o){if(null!=o){var r=function(){try{var s=l(o),r=c.BATCH_ASYNC_MODULE_UPDATES_FN,n=null!=r&&t._pendingModulePayloadsCount>1,a=d((function(){if(t._handleFollowupPayload(e,s),n)t._scheduleAsyncStoreUpdate(r,i.complete);else{var o=t._runPublishQueue();t._updateOperationTracker(o)}}))[0];t._log({name:"execute.async.module",executeId:t._executeId,operationName:s.name,duration:a}),n||i.complete()}catch(e){i.error(e)}},n=t._scheduler;null==n?r():s=n.schedule(r)}else i.complete()},error:i.error});return function(){o.unsubscribe(),null!=t._scheduler&&null!=s&&t._scheduler.cancel(s)}})).subscribe({complete:function(){t._complete(o),r()},error:function(e){t._error(e),r()},start:function(e){return t._start(o,e)}})}break;case"ActorPayload":this._processFollowupPayloadWithNormalizationNode(e,e.node);break;default:k(!1)}},t._processFollowupPayloadWithNormalizationNode=function(e,t){this._handleFollowupPayload(e,t),this._maybeCompleteSubscriptionOperationTracking()},t._handleFollowupPayload=function(e,t){var i=this._normalizeFollowupPayload(e,t);this._getPublishQueueAndSaveActor().commitPayload(this._operation,i),this._processPayloadFollowups([i])},t._processIncrementalPlaceholder=function(e,t){var i,s=t.label,o=t.path.map(String).join("."),r=this._incrementalResults.get(s);null==r&&(r=new Map,this._incrementalResults.set(s,r));var n,a=r.get(o),l=null!=a&&"response"===a.kind?a.responses:null;r.set(o,{kind:"placeholder",placeholder:t}),"stream"===t.kind?n=t.parentID:"defer"===t.kind?n=t.selector.dataID:k(!1);var u,c,d=e.source.get(n),h=(null!==(i=e.fieldPayloads)&&void 0!==i?i:[]).filter((function(e){var t=_(e.dataID,e.fieldKey);return e.dataID===n||t===n}));null==d&&k(!1);var f=this._source.get(n);if(null!=f){u=v.update(f.record,d);var m=new Map,g=function(e){var t,i,s=(t=e,null!==(i=JSON.stringify(p(t)))&&void 0!==i?i:"");m.set(s,e)};f.fieldPayloads.forEach(g),h.forEach(g),c=Array.from(m.values())}else u=d,c=h;if(this._source.set(n,{record:u,fieldPayloads:c}),null!=l){var y=this._processIncrementalResponses(l);this._processPayloadFollowups(y)}},t._processIncrementalResponses=function(e){var t=this,i=[];return e.forEach((function(e){var s=e.label,o=e.path,r=e.response,n=t._incrementalResults.get(s);if(null==n&&(n=new Map,t._incrementalResults.set(s,n)),-1!==s.indexOf("$defer$")){var a=o.map(String).join("."),l=n.get(a);if(null==l)return l={kind:"response",responses:[e]},void n.set(a,l);if("response"===l.kind)return void l.responses.push(e);var u=l.placeholder;"defer"!==u.kind&&k(!1),i.push(t._processDeferResponse(s,o,u,r))}else{var c=o.slice(0,-2).map(String).join("."),p=n.get(c);if(null==p)return p={kind:"response",responses:[e]},void n.set(c,p);if("response"===p.kind)return void p.responses.push(e);var d=p.placeholder;"stream"!==d.kind&&k(!1),i.push(t._processStreamResponse(s,o,d,r))}})),i},t._processDeferResponse=function(e,t,i,s){var o,r=i.selector.dataID,n=this._actorIdentifier;this._actorIdentifier=null!==(o=i.actorIdentifier)&&void 0!==o?o:this._actorIdentifier;var a=this._normalizeResponse(s,i.selector,i.typeName,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:i.path,treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents});this._getPublishQueueAndSaveActor().commitPayload(this._operation,a);var l=this._source.get(r);null==l&&k(!1);var u=l.fieldPayloads;if(0!==u.length){var c,p={errors:null,fieldPayloads:u,incrementalPlaceholders:null,followupPayloads:null,source:I.create(),isFinal:!0===(null===(c=s.extensions)||void 0===c?void 0:c.is_final)};this._getPublishQueueAndSaveActor().commitPayload(this._operation,p)}return this._actorIdentifier=n,a},t._processStreamResponse=function(e,t,i,s){var o=i.parentID,n=i.node,a=i.variables,l=i.actorIdentifier,u=this._actorIdentifier;this._actorIdentifier=null!=l?l:this._actorIdentifier;var c=n.selections[0];(null==c||"LinkedField"!==c.kind||!0!==c.plural)&&k(!1);var p=this._normalizeStreamItem(s,o,c,a,t,i.path),d=p.fieldPayloads,h=p.itemID,_=p.itemIndex,f=p.prevIDs,m=p.relayPayload,v=p.storageKey;if(this._getPublishQueueAndSaveActor().commitPayload(this._operation,m,(function(e){var t=e.get(o);if(null!=t){var i=t.getLinkedRecords(v);if(null!=i&&i.length===f.length&&!i.some((function(e,t){return f[t]!==(e&&e.getDataID())}))){var s=(0,r.default)(i);s[_]=e.get(h),t.setLinkedRecords(s,v)}}})),0!==d.length){var g={errors:null,fieldPayloads:d,incrementalPlaceholders:null,followupPayloads:null,source:I.create(),isFinal:!1};this._getPublishQueueAndSaveActor().commitPayload(this._operation,g)}return this._actorIdentifier=u,m},t._normalizeStreamItem=function(e,t,i,s,o,n){var a,l,u,c,p=e.data;"object"!=typeof p&&k(!1);var d=null!==(a=i.alias)&&void 0!==a?a:i.name,h=S(i,s),f=this._source.get(t);null==f&&k(!1);var m=f.record,g=f.fieldPayloads,P=v.getLinkedRecordIDs(m,h);null==P&&k(!1);var I=o[o.length-1],b=parseInt(I,10);b===I&&b>=0||k(!1);var D=null!==(l=i.concreteType)&&void 0!==l?l:p[A];"string"!=typeof D&&k(!1);var x=null!==(u=null!==(c=this._getDataID(p,D))&&void 0!==c?c:null==P?void 0:P[b])&&void 0!==u?u:_(t,h,b);"string"!=typeof x&&k(!1);var O=y(i,x,s),w=v.clone(m),C=(0,r.default)(P);return C[b]=x,v.setLinkedRecordIDs(w,h,C),this._source.set(t,{record:w,fieldPayloads:g}),{fieldPayloads:g,itemID:x,itemIndex:b,prevIDs:P,relayPayload:this._normalizeResponse(e,O,D,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:[].concat((0,r.default)(n),[d,String(b)]),treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents}),storageKey:h}},t._scheduleAsyncStoreUpdate=function(e,t){var i=this;this._completeFns.push(t),null==this._asyncStoreUpdateDisposable&&(this._asyncStoreUpdateDisposable=e((function(){i._asyncStoreUpdateDisposable=null;var e=i._runPublishQueue();i._updateOperationTracker(e);var t,s=(0,o.default)(i._completeFns);try{for(s.s();!(t=s.n()).done;)(0,t.value)()}catch(e){s.e(e)}finally{s.f()}i._completeFns=[]})))},t._updateOperationTracker=function(e){null!=e&&e.length>0&&this._operationTracker.update(this._operation.request,new Set(e))},t._completeOperationTracker=function(){this._operationTracker.complete(this._operation.request)},t._getPublishQueueAndSaveActor=function(){return this._seenActors.add(this._actorIdentifier),this._getPublishQueue(this._actorIdentifier)},t._getActorsToVisit=function(){return 0===this._seenActors.size?new Set([this._actorIdentifier]):this._seenActors},t._runPublishQueue=function(e){var t,i=new Set,s=(0,o.default)(this._getActorsToVisit());try{for(s.s();!(t=s.n()).done;){var r=t.value;this._getPublishQueue(r).run(e).forEach((function(e){return i.add(e)}))}}catch(e){s.e(e)}finally{s.f()}return Array.from(i)},t._retainData=function(){var e,t=(0,o.default)(this._getActorsToVisit());try{for(t.s();!(e=t.n()).done;){var i=e.value;this._retainDisposables.has(i)||this._retainDisposables.set(i,this._getStore(i).retain(this._operation))}}catch(e){t.e(e)}finally{t.f()}},t._disposeRetainedData=function(){var e,t=(0,o.default)(this._retainDisposables.values());try{for(t.s();!(e=t.n()).done;)e.value.dispose()}catch(e){t.e(e)}finally{t.f()}this._retainDisposables.clear()},t._expectOperationLoader=function(){var e=this._operationLoader;return e||k(!1),e},e}();function O(e){var t=e.incrementalPlaceholders;null!=t&&0!==t.length&&k(!1)}e.exports={execute:function(e){return new x(e)}}}}]);
//# sourceMappingURL=OperationExecutor.js.js.map?190f3