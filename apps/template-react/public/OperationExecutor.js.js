"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[342],{7384:(e,t,i)=>{function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}var o=i(6824).default,n=o(i(6579)),r=o(i(2839)),a=i(8963),l=i(493),u=i(7491),c=i(710),p=i(2761),d=i(3952),h=i(808),_=i(6133),f=_.generateClientID,m=_.generateUniqueClientID,v=i(6589).getLocalVariables,g=i(2306),y=i(1854),P=y.createNormalizationSelector,I=y.createReaderSelector,b=i(2651),D=i(8677),A=D.ROOT_TYPE,S=D.TYPENAME_KEY,k=D.getStorageKey,x=i(9990);i(575);var O=function(){function e(e){var t=this,i=e.actorIdentifier,s=e.getDataID,o=e.getPublishQueue,n=e.getStore,r=e.isClientPayload,a=e.operation,u=e.operationExecutions,c=e.operationLoader,p=e.operationTracker,d=e.optimisticConfig,h=e.scheduler,_=e.shouldProcessClientComponents,f=e.sink,m=e.source,v=e.treatMissingFieldsAsNull,g=e.updater,y=e.log,P=e.normalizeResponse;this._actorIdentifier=i,this._getDataID=s,this._treatMissingFieldsAsNull=v,this._incrementalPayloadsPending=!1,this._incrementalResults=new Map,this._log=y,this._executeId=l(),this._nextSubscriptionId=0,this._operation=a,this._operationExecutions=u,this._operationLoader=c,this._operationTracker=p,this._operationUpdateEpochs=new Map,this._optimisticUpdates=null,this._pendingModulePayloadsCount=0,this._getPublishQueue=o,this._scheduler=h,this._sink=f,this._source=new Map,this._state="started",this._getStore=n,this._subscriptions=new Map,this._updater=g,this._isClientPayload=!0===r,this._isSubscriptionOperation="subscription"===this._operation.request.node.params.operationKind,this._shouldProcessClientComponents=_,this._retainDisposables=new Map,this._seenActors=new Set,this._completeFns=[],this._normalizeResponse=P;var I=this._nextSubscriptionId++;m.subscribe({complete:function(){return t._complete(I)},error:function(e){return t._error(e)},next:function(e){try{t._next(I,e)}catch(e){f.error(e)}},start:function(e){var i;t._start(I,e),t._log({name:"execute.start",executeId:t._executeId,params:t._operation.request.node.params,variables:t._operation.request.variables,cacheConfig:null!==(i=t._operation.request.cacheConfig)&&void 0!==i?i:{}})}}),null!=d&&this._processOptimisticResponse(null!=d.response?{data:d.response}:null,d.updater,!1)}var t=e.prototype;return t.cancel=function(){var e=this;if("completed"!==this._state){this._state="completed",this._operationExecutions.delete(this._operation.request.identifier),0!==this._subscriptions.size&&(this._subscriptions.forEach((function(e){return e.unsubscribe()})),this._subscriptions.clear());var t=this._optimisticUpdates;null!==t&&(this._optimisticUpdates=null,t.forEach((function(t){return e._getPublishQueueAndSaveActor().revertUpdate(t)})),this._runPublishQueue()),this._incrementalResults.clear(),null!=this._asyncStoreUpdateDisposable&&(this._asyncStoreUpdateDisposable.dispose(),this._asyncStoreUpdateDisposable=null),this._completeFns=[],this._completeOperationTracker(),this._disposeRetainedData()}},t._updateActiveState=function(){var e;switch(this._state){case"started":case"loading_incremental":e="active";break;case"completed":e="inactive";break;case"loading_final":e=this._pendingModulePayloadsCount>0?"active":"inactive";break;default:this._state,x(!1)}this._operationExecutions.set(this._operation.request.identifier,e)},t._schedule=function(e){var t=this,i=this._scheduler;if(null!=i){var s=this._nextSubscriptionId++;a.create((function(t){var s=i.schedule((function(){try{e(),t.complete()}catch(e){t.error(e)}}));return function(){return i.cancel(s)}})).subscribe({complete:function(){return t._complete(s)},error:function(e){return t._error(e)},start:function(e){return t._start(s,e)}})}else e()},t._complete=function(e){this._subscriptions.delete(e),0===this._subscriptions.size&&(this.cancel(),this._sink.complete(),this._log({name:"execute.complete",executeId:this._executeId}))},t._error=function(e){this.cancel(),this._sink.error(e),this._log({name:"execute.error",executeId:this._executeId,error:e})},t._start=function(e,t){this._subscriptions.set(e,t),this._updateActiveState()},t._next=function(e,t){var i=this;this._schedule((function(){var e=h((function(){i._handleNext(t),i._maybeCompleteSubscriptionOperationTracking()}))[0];i._log({name:"execute.next",executeId:i._executeId,response:t,duration:e})}))},t._handleErrorResponse=function(e){var t=this,i=[];return e.forEach((function(e){if(null!==e.data||null==e.extensions||e.hasOwnProperty("errors")){if(null==e.data){var s=e.hasOwnProperty("errors")&&null!=e.errors?e.errors:null,o=s?s.map((function(e){return e.message})).join("\n"):"(No errors)",n=c.create("RelayNetwork","No data returned for operation `"+t._operation.request.node.params.name+"`, got error(s):\n"+o+"\n\nSee the error `source` property for more information.");throw n.source={errors:s,operation:t._operation.request.node,variables:t._operation.request.variables},n.stack,n}var r=e;i.push(r)}})),i},t._handleOptimisticResponses=function(e){var t;if(e.length>1)return e.some((function(e){var t;return!0===(null===(t=e.extensions)||void 0===t?void 0:t.isOptimistic)}))&&x(!1),!1;var i=e[0],s=!0===(null===(t=i.extensions)||void 0===t?void 0:t.isOptimistic);return s&&"started"!==this._state&&x(!1),!!s&&(this._processOptimisticResponse(i,null,this._treatMissingFieldsAsNull),this._sink.next(i),!0)},t._handleNext=function(e){if("completed"!==this._state){this._seenActors.clear();var t=Array.isArray(e)?e:[e],i=this._handleErrorResponse(t);if(0===i.length)return t.some((function(e){var t;return!0===(null===(t=e.extensions)||void 0===t?void 0:t.is_final)}))&&(this._state="loading_final",this._updateActiveState(),this._incrementalPayloadsPending=!1),void this._sink.next(e);if(!this._handleOptimisticResponses(i)){var s=function(e){var t=[],i=[];return e.forEach((function(e){if(null!=e.path||null!=e.label){var s=e.label,o=e.path;null!=s&&null!=o||x(!1),i.push({label:s,path:o,response:e})}else t.push(e)})),[t,i]}(i),o=s[0],n=s[1],r=o.length>0;if(r){if(this._isSubscriptionOperation){var a=m();this._operation={request:this._operation.request,fragment:I(this._operation.fragment.node,a,this._operation.fragment.variables,this._operation.fragment.owner),root:P(this._operation.root.node,a,this._operation.root.variables)}}var l=this._processResponses(o);this._processPayloadFollowups(l)}if(n.length>0){var u=this._processIncrementalResponses(n);this._processPayloadFollowups(u)}this._isSubscriptionOperation&&(null==i[0].extensions?i[0].extensions={__relay_subscription_root_id:this._operation.fragment.dataID}:i[0].extensions.__relay_subscription_root_id=this._operation.fragment.dataID);var c=this._runPublishQueue(r?this._operation:void 0);r&&this._incrementalPayloadsPending&&this._retainData(),this._updateOperationTracker(c),this._sink.next(e)}}},t._processOptimisticResponse=function(e,t,i){var s=this;if(null!==this._optimisticUpdates&&x(!1),null!=e||null!=t){var o=[];if(e){var n=this._normalizeResponse(e,this._operation.root,A,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:[],shouldProcessClientComponents:this._shouldProcessClientComponents,treatMissingFieldsAsNull:i});w(n),o.push({operation:this._operation,payload:n,updater:t}),this._processOptimisticFollowups(n,o)}else t&&o.push({operation:this._operation,payload:{errors:null,fieldPayloads:null,incrementalPlaceholders:null,followupPayloads:null,source:b.create(),isFinal:!1},updater:t});this._optimisticUpdates=o,o.forEach((function(e){return s._getPublishQueueAndSaveActor().applyUpdate(e)}));var r=this._runPublishQueue();p.ENABLE_OPERATION_TRACKER_OPTIMISTIC_UPDATES&&this._updateOperationTracker(r)}},t._processOptimisticFollowups=function(e,t){if(e.followupPayloads&&e.followupPayloads.length){var i,s=e.followupPayloads,o=(0,n.default)(s);try{for(o.s();!(i=o.n()).done;){var a=i.value;switch(a.kind){case"ModuleImportPayload":var l=this._expectOperationLoader().get(a.operationReference);if(null==l)this._processAsyncOptimisticModuleImport(a);else{var u=this._processOptimisticModuleImport(l,a);t.push.apply(t,(0,r.default)(u))}break;case"ActorPayload":break;default:x(!1)}}}catch(e){o.e(e)}finally{o.f()}}},t._normalizeFollowupPayload=function(e,t){var i;i="SplitOperation"===t.kind&&"ModuleImportPayload"===e.kind?v(e.variables,t.argumentDefinitions,e.args):e.variables;var s=P(t,e.dataID,i);return this._normalizeResponse({data:e.data},s,e.typeName,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:e.path,treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents})},t._processOptimisticModuleImport=function(e,t){var i=u(e),s=[],o=this._normalizeFollowupPayload(t,i);return w(o),s.push({operation:this._operation,payload:o,updater:null}),this._processOptimisticFollowups(o,s),s},t._processAsyncOptimisticModuleImport=function(e){var t=this;this._expectOperationLoader().load(e.operationReference).then((function(i){if(null!=i&&"started"===t._state){var s,o=t._processOptimisticModuleImport(i,e);o.forEach((function(e){return t._getPublishQueueAndSaveActor().applyUpdate(e)})),null==t._optimisticUpdates||((s=t._optimisticUpdates).push.apply(s,(0,r.default)(o)),t._runPublishQueue())}}))},t._processResponses=function(e){var t=this;return null!==this._optimisticUpdates&&(this._optimisticUpdates.forEach((function(e){t._getPublishQueueAndSaveActor().revertUpdate(e)})),this._optimisticUpdates=null),this._incrementalPayloadsPending=!1,this._incrementalResults.clear(),this._source.clear(),e.map((function(e){var i=t._normalizeResponse(e,t._operation.root,A,{actorIdentifier:t._actorIdentifier,getDataID:t._getDataID,path:[],treatMissingFieldsAsNull:t._treatMissingFieldsAsNull,shouldProcessClientComponents:t._shouldProcessClientComponents});return t._getPublishQueueAndSaveActor().commitPayload(t._operation,i,t._updater),i}))},t._processPayloadFollowups=function(e){var t=this;"completed"!==this._state&&e.forEach((function(e){var i=e.incrementalPlaceholders,s=e.followupPayloads,o=e.isFinal;if(t._state=o?"loading_final":"loading_incremental",t._updateActiveState(),o&&(t._incrementalPayloadsPending=!1),s&&0!==s.length&&s.forEach((function(e){var i,s=t._actorIdentifier;t._actorIdentifier=null!==(i=e.actorIdentifier)&&void 0!==i?i:t._actorIdentifier,t._processFollowupPayload(e),t._actorIdentifier=s})),i&&0!==i.length&&(t._incrementalPayloadsPending="loading_final"!==t._state,i.forEach((function(i){var s,o=t._actorIdentifier;t._actorIdentifier=null!==(s=i.actorIdentifier)&&void 0!==s?s:t._actorIdentifier,t._processIncrementalPlaceholder(e,i),t._actorIdentifier=o})),t._isClientPayload||"loading_final"===t._state)){var n=[];i.forEach((function(e){"defer"===e.kind&&n.push(t._processDeferResponse(e.label,e.path,e,{data:e.data}))})),n.length>0&&t._processPayloadFollowups(n)}}))},t._maybeCompleteSubscriptionOperationTracking=function(){this._isSubscriptionOperation&&0===this._pendingModulePayloadsCount&&!1===this._incrementalPayloadsPending&&this._completeOperationTracker()},t._processFollowupPayload=function(e){var t=this;switch(e.kind){case"ModuleImportPayload":var i=this._expectOperationLoader(),s=i.get(e.operationReference);if(null!=s)this._processFollowupPayloadWithNormalizationNode(e,u(s));else{var o=this._nextSubscriptionId++;this._pendingModulePayloadsCount++;var n=function(){t._pendingModulePayloadsCount--,t._maybeCompleteSubscriptionOperationTracking()},r=a.from(new Promise((function(t,s){i.load(e.operationReference).then(t,s)})));a.create((function(i){var s,o=r.subscribe({next:function(o){if(null!=o){var n=function(){try{var s=u(o),n=p.BATCH_ASYNC_MODULE_UPDATES_FN,r=null!=n&&t._pendingModulePayloadsCount>1,a=h((function(){if(t._handleFollowupPayload(e,s),r)t._scheduleAsyncStoreUpdate(n,i.complete);else{var o=t._runPublishQueue();t._updateOperationTracker(o)}}))[0];t._log({name:"execute.async.module",executeId:t._executeId,operationName:s.name,duration:a}),r||i.complete()}catch(e){i.error(e)}},r=t._scheduler;null==r?n():s=r.schedule(n)}else i.complete()},error:i.error});return function(){o.unsubscribe(),null!=t._scheduler&&null!=s&&t._scheduler.cancel(s)}})).subscribe({complete:function(){t._complete(o),n()},error:function(e){t._error(e),n()},start:function(e){return t._start(o,e)}})}break;case"ActorPayload":this._processFollowupPayloadWithNormalizationNode(e,e.node);break;default:x(!1)}},t._processFollowupPayloadWithNormalizationNode=function(e,t){this._handleFollowupPayload(e,t),this._maybeCompleteSubscriptionOperationTracking()},t._handleFollowupPayload=function(e,t){var i=this._normalizeFollowupPayload(e,t);this._getPublishQueueAndSaveActor().commitPayload(this._operation,i),this._processPayloadFollowups([i])},t._processIncrementalPlaceholder=function(e,t){var i,s=t.label,o=t.path.map(String).join("."),n=this._incrementalResults.get(s);null==n&&(n=new Map,this._incrementalResults.set(s,n));var r,a=n.get(o),l=null!=a&&"response"===a.kind?a.responses:null;n.set(o,{kind:"placeholder",placeholder:t}),"stream"===t.kind?r=t.parentID:"defer"===t.kind?r=t.selector.dataID:x(!1);var u,c,p=e.source.get(r),h=(null!==(i=e.fieldPayloads)&&void 0!==i?i:[]).filter((function(e){var t=f(e.dataID,e.fieldKey);return e.dataID===r||t===r}));null==p&&x(!1);var _=this._source.get(r);if(null!=_){u=g.update(_.record,p);var m=new Map,v=function(e){var t,i,s=(t=e,null!==(i=JSON.stringify(d(t)))&&void 0!==i?i:"");m.set(s,e)};_.fieldPayloads.forEach(v),h.forEach(v),c=Array.from(m.values())}else u=p,c=h;if(this._source.set(r,{record:u,fieldPayloads:c}),null!=l){var y=this._processIncrementalResponses(l);this._processPayloadFollowups(y)}},t._processIncrementalResponses=function(e){var t=this,i=[];return e.forEach((function(e){var s=e.label,o=e.path,n=e.response,r=t._incrementalResults.get(s);if(null==r&&(r=new Map,t._incrementalResults.set(s,r)),-1!==s.indexOf("$defer$")){var a=o.map(String).join("."),l=r.get(a);if(null==l)return l={kind:"response",responses:[e]},void r.set(a,l);if("response"===l.kind)return void l.responses.push(e);var u=l.placeholder;"defer"!==u.kind&&x(!1),i.push(t._processDeferResponse(s,o,u,n))}else{var c=o.slice(0,-2).map(String).join("."),p=r.get(c);if(null==p)return p={kind:"response",responses:[e]},void r.set(c,p);if("response"===p.kind)return void p.responses.push(e);var d=p.placeholder;"stream"!==d.kind&&x(!1),i.push(t._processStreamResponse(s,o,d,n))}})),i},t._processDeferResponse=function(e,t,i,s){var o,n=i.selector.dataID,r=this._actorIdentifier;this._actorIdentifier=null!==(o=i.actorIdentifier)&&void 0!==o?o:this._actorIdentifier;var a=this._normalizeResponse(s,i.selector,i.typeName,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:i.path,treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents});this._getPublishQueueAndSaveActor().commitPayload(this._operation,a);var l=this._source.get(n);null==l&&x(!1);var u=l.fieldPayloads;if(0!==u.length){var c,p={errors:null,fieldPayloads:u,incrementalPlaceholders:null,followupPayloads:null,source:b.create(),isFinal:!0===(null===(c=s.extensions)||void 0===c?void 0:c.is_final)};this._getPublishQueueAndSaveActor().commitPayload(this._operation,p)}return this._actorIdentifier=r,a},t._processStreamResponse=function(e,t,i,s){var o=i.parentID,n=i.node,a=i.variables,l=i.actorIdentifier,u=this._actorIdentifier;this._actorIdentifier=null!=l?l:this._actorIdentifier;var c=n.selections[0];(null==c||"LinkedField"!==c.kind||!0!==c.plural)&&x(!1);var p=this._normalizeStreamItem(s,o,c,a,t,i.path),d=p.fieldPayloads,h=p.itemID,_=p.itemIndex,f=p.prevIDs,m=p.relayPayload,v=p.storageKey;if(this._getPublishQueueAndSaveActor().commitPayload(this._operation,m,(function(e){var t=e.get(o);if(null!=t){var i=t.getLinkedRecords(v);if(null!=i&&i.length===f.length&&!i.some((function(e,t){return f[t]!==(e&&e.getDataID())}))){var s=(0,r.default)(i);s[_]=e.get(h),t.setLinkedRecords(s,v)}}})),0!==d.length){var g={errors:null,fieldPayloads:d,incrementalPlaceholders:null,followupPayloads:null,source:b.create(),isFinal:!1};this._getPublishQueueAndSaveActor().commitPayload(this._operation,g)}return this._actorIdentifier=u,m},t._normalizeStreamItem=function(e,t,i,o,n,a){var l,u,c,p,d=e.data;"object"!==s(d)&&x(!1);var h=null!==(l=i.alias)&&void 0!==l?l:i.name,_=k(i,o),m=this._source.get(t);null==m&&x(!1);var v=m.record,y=m.fieldPayloads,I=g.getLinkedRecordIDs(v,_);null==I&&x(!1);var b=n[n.length-1],D=parseInt(b,10);D===b&&D>=0||x(!1);var A=null!==(u=i.concreteType)&&void 0!==u?u:d[S];"string"!=typeof A&&x(!1);var O=null!==(c=null!==(p=this._getDataID(d,A))&&void 0!==p?p:null==I?void 0:I[D])&&void 0!==c?c:f(t,_,D);"string"!=typeof O&&x(!1);var w=P(i,O,o),C=g.clone(v),R=(0,r.default)(I);return R[D]=O,g.setLinkedRecordIDs(C,_,R),this._source.set(t,{record:C,fieldPayloads:y}),{fieldPayloads:y,itemID:O,itemIndex:D,prevIDs:I,relayPayload:this._normalizeResponse(e,w,A,{actorIdentifier:this._actorIdentifier,getDataID:this._getDataID,path:[].concat((0,r.default)(a),[h,String(D)]),treatMissingFieldsAsNull:this._treatMissingFieldsAsNull,shouldProcessClientComponents:this._shouldProcessClientComponents}),storageKey:_}},t._scheduleAsyncStoreUpdate=function(e,t){var i=this;this._completeFns.push(t),null==this._asyncStoreUpdateDisposable&&(this._asyncStoreUpdateDisposable=e((function(){i._asyncStoreUpdateDisposable=null;var e=i._runPublishQueue();i._updateOperationTracker(e);var t,s=(0,n.default)(i._completeFns);try{for(s.s();!(t=s.n()).done;)(0,t.value)()}catch(e){s.e(e)}finally{s.f()}i._completeFns=[]})))},t._updateOperationTracker=function(e){null!=e&&e.length>0&&this._operationTracker.update(this._operation.request,new Set(e))},t._completeOperationTracker=function(){this._operationTracker.complete(this._operation.request)},t._getPublishQueueAndSaveActor=function(){return this._seenActors.add(this._actorIdentifier),this._getPublishQueue(this._actorIdentifier)},t._getActorsToVisit=function(){return 0===this._seenActors.size?new Set([this._actorIdentifier]):this._seenActors},t._runPublishQueue=function(e){var t,i=new Set,s=(0,n.default)(this._getActorsToVisit());try{for(s.s();!(t=s.n()).done;){var o=t.value;this._getPublishQueue(o).run(e).forEach((function(e){return i.add(e)}))}}catch(e){s.e(e)}finally{s.f()}return Array.from(i)},t._retainData=function(){var e,t=(0,n.default)(this._getActorsToVisit());try{for(t.s();!(e=t.n()).done;){var i=e.value;this._retainDisposables.has(i)||this._retainDisposables.set(i,this._getStore(i).retain(this._operation))}}catch(e){t.e(e)}finally{t.f()}},t._disposeRetainedData=function(){var e,t=(0,n.default)(this._retainDisposables.values());try{for(t.s();!(e=t.n()).done;)e.value.dispose()}catch(e){t.e(e)}finally{t.f()}this._retainDisposables.clear()},t._expectOperationLoader=function(){var e=this._operationLoader;return e||x(!1),e},e}();function w(e){var t=e.incrementalPlaceholders;null!=t&&0!==t.length&&x(!1)}e.exports={execute:function(e){return new O(e)}}}}]);
//# sourceMappingURL=OperationExecutor.js.js.map?11d77