"use strict";(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[37],{9815:(e,t,n)=>{var r=n(6824).default,s=r(n(7931)),i=r(n(1887)),a=r(n(2839)),o=n(4911),u=n(9001).getQueryResourceForEnvironment,l=n(4183),c=n(9990),d=n(5289),h=d.__internal,g=h.fetchQuery,v=h.getPromiseForActiveRequest,f=d.RelayFeatureFlags,p=d.createOperationDescriptor,_=d.getFragmentIdentifier,E=d.getPendingOperationsForFragment,m=d.getSelector,R=d.getVariablesFromFragment,y=d.handlePotentialSnapshotErrors,A=d.isPromise,S=d.recycleNodesInto,D="function"==typeof WeakMap,L=Object.freeze([]);function k(e){return Array.isArray(e)?e.some((function(e){return e.isMissingData})):e.isMissingData}function C(e){return Array.isArray(e)?e.map((function(e){return e.missingLiveResolverFields})).filter(Boolean).flat():e.missingLiveResolverFields}function O(e,t,n){return Array.isArray(t)?{cacheKey:e,snapshot:t,data:t.map((function(e){return e.data})),isMissingData:k(t),storeEpoch:n}:{cacheKey:e,snapshot:t,data:t.data,isMissingData:k(t),storeEpoch:n}}var N=function(){function e(e){(0,i.default)(this,"_cache",new Map),(0,i.default)(this,"_retainCounts",new Map),this._environment=e}var t=e.prototype;return t.get=function(e){var t,n;return null!==(t=null===(n=this._cache.get(e))||void 0===n?void 0:n[0])&&void 0!==t?t:void 0},t.recordQueryResults=function(e,t){var n=this,r=this._cache.get(e);if(r){var s=r[0],i=r[1];t.forEach((function(e){s.push(e)})),i.temporaryRetain(this._environment)}else{var a=new l((function(){return n._retain(e)}));this._cache.set(e,[t,a]),a.temporaryRetain(this._environment)}},t._retain=function(e){var t,n=this,r=(null!==(t=this._retainCounts.get(e))&&void 0!==t?t:0)+1;return this._retainCounts.set(e,r),{dispose:function(){var t,r=(null!==(t=n._retainCounts.get(e))&&void 0!==t?t:0)-1;r>0?n._retainCounts.set(e,r):(n._retainCounts.delete(e),n._cache.delete(e))}}},e}(),F=function(){function e(e){this._environment=e,this._cache=o.create(1e6),f.ENABLE_CLIENT_EDGES&&(this._clientEdgeQueryResultsCache=new N(e))}var t=e.prototype;return t.read=function(e,t,n,r){return this.readWithIdentifier(e,t,_(e,t),n,r)},t.readWithIdentifier=function(e,t,n,r,s){var i,o,l,d,h=this,g=this._environment;if(null==t)return{cacheKey:n,data:null,isMissingData:!1,snapshot:null,storeEpoch:0};var p=g.getStore().getEpoch();if(!0===(null==e||null===(i=e.metadata)||void 0===i?void 0:i.plural)&&(Array.isArray(t)||c(!1),0===t.length))return{cacheKey:n,data:L,isMissingData:!1,snapshot:L,storeEpoch:p};var _=this._cache.get(n);if(null!=_){var E;if("pending"===_.kind&&A(_.promise))throw g.__log({name:"suspense.fragment",data:_.result.data,fragment:e,isRelayHooks:!0,isMissingData:_.result.isMissingData,isPromiseCached:!0,pendingOperations:_.pendingOperations}),_.promise;if("done"===_.kind&&_.result.snapshot&&(null===(E=C(_.result.snapshot))||void 0===E||!E.length))return this._throwOrLogErrorsInSnapshot(_.result.snapshot),_.result.isMissingData&&g.__log({name:"fragmentresource.missing_data",data:_.result.data,fragment:e,isRelayHooks:!0,cached:!0}),_.result}var R=m(e,t);null==R&&c(!1);var y=null,S=null;if(f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&null!=_&&"missing"===_.kind?(y=_.result,S=_.snapshot):y=O(n,S="PluralReaderSelector"===R.kind?R.selectors.map((function(e){return g.lookup(e)})):g.lookup(R),p),!y.isMissingData)return this._throwOrLogErrorsInSnapshot(S),this._cache.set(n,{kind:"done",result:y}),y;var D=null;if(f.ENABLE_CLIENT_EDGES&&!0===(null===(o=e.metadata)||void 0===o?void 0:o.hasClientEdges)&&function(e){var t,n;return Array.isArray(e)?e.some((function(e){var t,n;return(null!==(t=null===(n=e.missingClientEdges)||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0})):(null!==(t=null===(n=e.missingClientEdges)||void 0===n?void 0:n.length)&&void 0!==t?t:0)>0}(S)){D=[];var k=u(this._environment),N=[];!function(e,t){Array.isArray(e)?e.forEach(t):t(e)}(S,(function(n){var r;null===(r=n.missingClientEdges)||void 0===r||r.forEach((function(n){var r,s=n.request,i=n.clientEdgeDestinationID,a=h._performClientEdgeQuery(k,e,t,s,i),o=a.queryResult,u=a.requestDescriptor;N.push(o),null===(r=D)||void 0===r||r.push(u)}))})),null==this._clientEdgeQueryResultsCache&&c(!1),this._clientEdgeQueryResultsCache.recordQueryResults(n,N)}var F=[];f.ENABLE_CLIENT_EDGES&&D&&(F=D.map((function(e){return v(h._environment,e)})).filter(Boolean));var M="PluralReaderSelector"===R.kind?R.selectors[0].owner:R.owner,P=this._getAndSavePromiseForFragmentRequestInFlight(n,e,M,y),I=null==P?void 0:P.promise,w=null!==(l=null===(d=C(S))||void 0===d?void 0:d.map((function(e){var t=e.liveStateID;return g.getStore().getLiveResolverPromise(t)})))&&void 0!==l?l:[];if(F.length||w.length||A(I)){var T,b;g.__log({name:"suspense.fragment",data:y.data,fragment:e,isRelayHooks:!0,isPromiseCached:!1,isMissingData:y.isMissingData,pendingOperations:[].concat((0,a.default)(null!==(T=null==P?void 0:P.pendingOperations)&&void 0!==T?T:[]),(0,a.default)(null!==(b=D)&&void 0!==b?b:[]))});var B=[];if(F.length>0&&(B=B.concat(F)),w.length>0&&(B=B.concat(w)),B.length>0)throw I&&B.push(I),Promise.all(B);if(I)throw I}return f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&y.isMissingData&&this._cache.set(n,{kind:"done",result:y}),this._throwOrLogErrorsInSnapshot(S),g.__log({name:"fragmentresource.missing_data",data:y.data,fragment:e,isRelayHooks:!0,cached:!1}),O(n,S,p)},t._performClientEdgeQuery=function(e,t,n,r,i){var a=R(t,n),o=(0,s.default)((0,s.default)({},a),{},{id:i}),u=p(r,o,{}),l=g(this._environment,u),c=e.prepare(u,l);return{requestDescriptor:u.request,queryResult:c}},t._throwOrLogErrorsInSnapshot=function(e){var t=this;Array.isArray(e)?e.forEach((function(e){y(t._environment,e.missingRequiredFields,e.relayResolverErrors,e.errorResponseFields)})):y(this._environment,e.missingRequiredFields,e.relayResolverErrors,e.errorResponseFields)},t.readSpec=function(e,t,n){var r={};for(var s in e)r[s]=this.read(e[s],t[s],n,s);return r},t.subscribe=function(e,t){var n=this,r=this._environment,s=e.cacheKey,i=e.snapshot;if(!i)return{dispose:function(){}};var a=this.checkMissedUpdates(e),o=a[0],l=a[1];o&&t();var d=[];if(Array.isArray(i)?(Array.isArray(l)||c(!1),l.forEach((function(e,i){d.push(r.subscribe(e,(function(e){var a=r.getStore().getEpoch();n._updatePluralSnapshot(s,l,e,i,a),t()})))}))):((null==l||Array.isArray(l))&&c(!1),d.push(r.subscribe(l,(function(e){var i=r.getStore().getEpoch(),a=O(s,e,i);f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&a.isMissingData?n._cache.set(s,{kind:"missing",result:a,snapshot:e}):n._cache.set(s,{kind:"done",result:O(s,e,i)}),t()})))),f.ENABLE_CLIENT_EDGES){var h,g,v=null!==(h=null===(g=this._clientEdgeQueryResultsCache)||void 0===g?void 0:g.get(s))&&void 0!==h?h:void 0;if(null!=v&&v.length){var p=u(this._environment);v.forEach((function(e){d.push(p.retain(e))}))}}return{dispose:function(){d.forEach((function(e){return e.dispose()})),n._cache.delete(s)}}},t.subscribeSpec=function(e,t){var n=this,r=Object.keys(e).map((function(r){return n.subscribe(e[r],t)}));return{dispose:function(){r.forEach((function(e){e.dispose()}))}}},t.checkMissedUpdates=function(e){var t,n=this._environment,r=e.snapshot;if(!r)return[!1,null];if(t=n.getStore().getEpoch(),e.storeEpoch===t)return[!1,e.snapshot];var i=e.cacheKey;if(Array.isArray(r)){var a=!1,o=[];if(r.forEach((function(e,t){var r=n.lookup(e.selector),i=e.data,u=r.data,l=S(i,u);l!==i&&(r=(0,s.default)((0,s.default)({},r),{},{data:l}),a=!0),o[t]=r})),a){var u=O(i,o,t);f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&u.isMissingData?this._cache.set(i,{kind:"missing",result:u,snapshot:o}):this._cache.set(i,{kind:"done",result:u})}return[a,o]}var l=n.lookup(r.selector),c=r.data,d=l.data,h=S(c,d),g={data:h,isMissingData:l.isMissingData,missingClientEdges:l.missingClientEdges,missingLiveResolverFields:l.missingLiveResolverFields,seenRecords:l.seenRecords,selector:l.selector,missingRequiredFields:l.missingRequiredFields,relayResolverErrors:l.relayResolverErrors,errorResponseFields:l.errorResponseFields};if(h!==c){var v=O(i,g,t);f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&v.isMissingData?this._cache.set(i,{kind:"missing",result:v,snapshot:g}):this._cache.set(i,{kind:"done",result:v})}return[h!==c,g]},t.checkMissedUpdatesSpec=function(e){var t=this;return Object.keys(e).some((function(n){return t.checkMissedUpdates(e[n])[0]}))},t._getAndSavePromiseForFragmentRequestInFlight=function(e,t,n,r){var s=this,i=E(this._environment,t,n);if(null==i)return null;var a=i.promise,o=i.pendingOperations,u=a.then((function(){s._cache.delete(e)})).catch((function(t){s._cache.delete(e)}));return u.displayName=a.displayName,this._cache.set(e,{kind:"pending",pendingOperations:o,promise:u,result:r}),{promise:u,pendingOperations:o}},t._updatePluralSnapshot=function(e,t,n,r,s){var i,o=this._cache.get(e);if(A(o))M(n.selector.node.name);else{var u=null==o||null===(i=o.result)||void 0===i?void 0:i.snapshot;if(!u||Array.isArray(u)){var l=u?(0,a.default)(u):(0,a.default)(t);l[r]=n;var c=O(e,l,s);f.ENABLE_RELAY_OPERATION_TRACKER_SUSPENSE&&c.isMissingData?this._cache.set(e,{kind:"missing",result:c,snapshot:l}):this._cache.set(e,{kind:"done",result:c})}else M(n.selector.node.name)}},e}();function M(e){c(!1)}function P(e){return new F(e)}var I=D?new WeakMap:new Map;e.exports={createFragmentResource:P,getFragmentResourceForEnvironment:function(e){var t=I.get(e);if(t)return t;var n=P(e);return I.set(e,n),n}}}}]);
//# sourceMappingURL=FragmentResource.js.js.map?c3584